<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Account</title>
    <%- include partials/head.ejs %>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    
    <div> Connecting as client </div>
    <%- include partials/scripts.ejs %>
    <script>
      var socket = io('http://localhost:8080');

      socket.emit("client_connect");

      socket.on("connect", () => {
        console.log("Connected");
      })

      socket.on("scrape", (data) => {
        console.log(`Scraping url ${data.url}`);

        // Send request through CORS proxy first to avoid access error
        const proxyurl = "https://cors-anywhere.herokuapp.com/";
        const url = "https://" + data.url;
        socket.emit("return_result", {
          result: "TEST",
          user_id: data.user_id
        })
        // fetch(proxyurl + data.url) // https://cors-anywhere.herokuapp.com/https://example.com
        // .then(response => response.text())
        // .then(contents => {
        //   console.log("Returning result to user");
        //   io.emit("return_result", {
        //     result: contents
        //   })
        // })
        // .catch(() => console.log("Canâ€™t access " + url + " response. Blocked by browser?"))
      });
    </script>
  </body>
</html>
